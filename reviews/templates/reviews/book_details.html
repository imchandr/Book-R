{% extends 'reviews/home.html' %}
{% load humanize %}

{% block content %}

<div class="flex items-center justify-center min-h-screen ">
  <div class="w-3/4 h-auto">
    <div class="bg-white shadow-xl rounded-lg overflow-hidden md:flex border-2">
      <div class="my-auto">
        <img src="{{book.image.url}}" class=" px-8 py-6 mx-20 " alt="..." />
        {% comment %} <svg class="mb-4 ml-24 w-4 h-4 mx-px fill-current text-green-600"
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14">
          <path
            d="M6.43 12l-2.36 1.64a1 1 0 0 1-1.53-1.11l.83-2.75a1 1 0 0 0-.35-1.09L.73 6.96a1 1 0 0 1 .59-1.8l2.87-.06a1 1 0 0 0 .92-.67l.95-2.71a1 1 0 0 1 1.88 0l.95 2.71c.13.4.5.66.92.67l2.87.06a1 1 0 0 1 .59 1.8l-2.3 1.73a1 1 0 0 0-.34 1.09l.83 2.75a1 1 0 0 1-1.53 1.1L7.57 12a1 1 0 0 0-1.14 0z" />
        </svg> {% endcomment %}

      </div>

      <div class="w-4/5 md:p-5  mx-auto my-2">
        <h1 class="text-4xl font-bold underline pl-28">{{ book.title }}</h1>
        <h3 class="font-semi-bold text-blue-600 text-md md:text-md mt-4 hover:underline pl-28">Author <span
            class='pl-2'></span>
          {{author.first_name}}<span class="pl-2">{{author.last_name}}</span> </h3>
        <h3 class="font-semi-bold text-blue-600 text-md md:text-md hover:underline pl-28">Publisher <span
            class='pl-2'></span>
          {{book.publisher}}</h3>

        <table class="w-full flex flex-row flex-no-wrap  overflow-hidden  mt-5 mb-12 pl-28">

          <tbody class="flex-1 sm:flex-none text-medium text-lg text-gray-600">
            <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
              <td class="border-grey-200 hover:bg-gray-100 ">Genre</td>
              <td class="border-grey-200 hover:bg-gray-100 ">{{book.genre}}</td>
            </tr>
            <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
              <td class="border-grey-200 hover:bg-gray-100 pt-2">Language</td>
              <td class="border-grey-200 hover:bg-gray-100 pt-2"> <span class='mr-3'></span> {{book.language}}</td>
            </tr>
            <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
              <td class="border-grey-200 hover:bg-gray-100 pt-2">Formate</td>
              <td class="border-grey-200 hover:bg-gray-100 pt-2"> <span class='mr-3'></span> {{book.type}}</td>
            </tr>
            <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
              <td class="border-grey-200 hover:bg-gray-100 pt-2">Price</td>
              <td class="border-grey-200 hover:bg-gray-100 pt-2">₹ <span class='pr-2'></span> {{book.price}}</td>
            </tr>
            <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
              <td class="border-grey-200 hover:bg-gray-100 pt-2">ISBN</td>
              <td class="border-grey-200 hover:bg-gray-100 pt-2">{{book.isbn}}</td>
            </tr>
          </tbody>
        </table>
        <form action="order/">
        <button {% if book.stock %}
          class="mt-6 sm:mt-0 py-2 px-5 md:py-2 md:px-3 bg-indigo-700 hover:bg-indigo-600 font-bold text-white md:text-sm rounded-lg shadow-md ml-28">BUY
          NOW
        </button>
        <span class='pl-4 '></span>
        <button
          class="mt-3 sm:mt-0 py-2 px-5 py-2 md:px-3 bg-indigo-700 hover:bg-indigo-600 font-bold text-white md:text-sm rounded-lg shadow-md">ADD
          TO CART
        </button>
      </form>
        {% else %}
        <span class='pl-28 '></span>
        <button
          class="mt-3 sm:mt-0 py-2 px-5 py-2 md:px-3 bg-red-400 hover:bg-red-500 font-bold text-white md:text-sm rounded-lg shadow-md">CURRENTLY
          OUT OF STOCK
        </button>
        {% endif %}
      </div>

    </div>

  </div>
</div>


<div class="flex justify-center">
  <div
    class="block p-6 rounded-lg shadow-lg bg-white max-w-4xl border-2 mb-4 text-gray-600 text-base text-lg tracking-wide leading-8 text-justify px-12 py-16">

    <h5 class="text-gray-900 text-3xl leading-tight font-medium mb-2 text-center -mt-4 mb-8 underline">Book Description
    </h5>
    <p class="text-green">
      {{book.description|safe}}
    </p>
  </div>
</div>


<div class="flex justify-center my-8">
  <div class="block py-6 rounded-lg shadow-lg bg-white w-3/5 border-2">
    <!--book comment section -->
    <div class="block p-6 rounded-lg  bg-white max-w-4xl">
      <h5 class="text-gray-900 text-3xl leading-tight font-medium mb-2 text-center mb-8 underline py-8">Book Details</h5>
    <table
      class="w-4/5 mx-auto  overflow-hidden  mt-5 mb-12 pl-20 text-gray-600 text-base text-xl tracking-wide leading-8 text-justify px-6  my-4">

      <tbody class=" flex-1 sm:flex-none text-medium text-lg text-gray-600 shadow-lg">
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 ">ISBN</td>
          <td class="border-grey-200 hover:bg-gray-100">{{book.isbn}}</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 ">Publication Date</td>
          <td class="border-grey-200 hover:bg-gray-100">{{book.publication_date}}</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 ">Publisher</td>
          <td class="border-grey-200 hover:bg-gray-100">{{book.publisher}}</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 ">Available Formate</td>
          <td class="border-grey-200 hover:bg-gray-100">{{book.type}}</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 ">Number of pages</td>
          <td class="border-grey-200 hover:bg-gray-100">450</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 pt-2">Dimension</td>
          <td class="border-grey-200 hover:bg-gray-100 pt-2"> 5"x8" </td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 pt-2">Binding</td>
          <td class="border-grey-200 hover:bg-gray-100 pt-2"> Paperback (Perfect Binding)</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 pt-2">Interior Pages</td>
          <td class="border-grey-200 hover:bg-gray-100 pt-2">Black & White</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 pt-2">Price</td>
          <td class="border-grey-200 hover:bg-gray-100 pt-2">₹ <span class='pr-2'></span> {{book.price}}</td>
        </tr>
        <tr class="flex flex-col flex-no wrap sm:table-row  sm:mb-0 border-b-2">
          <td class="border-grey-200 hover:bg-gray-100 ">Availability</td>
          {% if book.stock  %}
          <td class="border-grey-200 hover:bg-gray-100 text-semibold text-green-500">In Stock</td>
          {% else %}
          <td class="border-grey-200 hover:bg-gray-100 text-semibold text-red-500">Out of Stock</td>
          {% endif %}
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>

<div class="flex justify-center">
  <div class="block p-6 rounded-lg shadow-lg bg-white max-w-4xl border-2">
    <!--book comment section -->
    <div class="block p-6 rounded-lg  bg-white max-w-4xl">
      <!--comment count -->
      {% with comments.count as total_comments %}
      <h5 class="text-gray-900 text-3xl leading-tight font-medium mb-2 text-center mb-8 underline">Book Reviews</h5>
      <h2 class="my-8 text-xl flex items-center space-x-2 leading-tight font-medium mb-2 text-center">
        {{ total_comments }} Review{{ total_comments|pluralize }}

      </h2>
      {% endwith %}

      <!--comment loop-->
      {% for comment in comments %}

      <div class=''>
        <div class="shadow-lg pt-4 ml-2 mr-2 rounded-lg mb-4 ">
          <a href="#" class="block bg-white py-3 rounded-lg shadow-lg border-2 pb-4 ">
            <div class="px-4 py-2 flex  justify-between">
              <span class="text-sm font-semibold text-gray-900">{{comment.author}}</span>
              <div class="flex">
                <span class="px-4 text-sm font-semibold text-gray-600"> {{comment.date_created|naturalday}}</span>
                <img class="h-6 w-6 rounded-full object-cover"
                  src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=4&w=144&q=80"
                  alt="">
              </div>
            </div>
            <p class="px-4 py-2 text-sm font-medium text-gray-600 text-justify">{{comment.content}}</p>
            <p class="px-4 py-2 text-sm font-medium text-gray-600"><span class='pr-4'>rating</span> {{comment.rating}}
            </p>
          </a>
        </div>
        <div class="mb-4 flex justify-start items-center text-sm w-full">
          <div class="font-semibold text-gray-700 px-4 flex items-center justify-center space-x-1">
            <a href="#" class="hover:underline">
              <small>Like</small>
            </a>
            <small class="self-center">.</small>
            <a href="#" class="hover:underline">
              <small>Upvote</small>
            </a>

            {% if request.user == comment.author %}
            <small class="self-center">.</small>
            <a href="#" class="hover:underline text-red-500">
              <small>Delete-review</small>
            </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}


      {% if request.user.is_authenticated %}

      <!-- comment form -->
      <div class="flex items-center justify-center shadow-lg my-12 w-full">
        <form method='post' class="w-full max-w-xxl bg-gray-200 rounded-lg px-4 pt-2">
          {% csrf_token %}
          <div class="flex flex-wrap -mx-3 mb-6 ">
            <h2 class="px-4 pt-3 pb-2 text-gray-800  text-lg">Add Review for {{book.title}} </h2>
            <div class="w-full md:w-full px-3 mb-2 mt-2">
              {{comment_form.content}}
              {{comment_form.rating}}
              <div class="pt-4 ">
                <input type='submit'
                  class=" bg-white text-gray-700 font-medium py-1 px-4 border border-gray-400 rounded-lg tracking-wide hover:bg-gray-100"
                  value='Post Review'>
              </div>
            </div>
        </form>
      </div>
    </div>

    {% else%}
    
    <h2 class="my-4 px-auto space-x-2 text-xl text-semibold text-red-600">Please <a href="{% url 'user_account:login' %}" class='hover:text-blue-600 hover:underline'>sign-in</a> to add review</h2>
    {% endif %}

  </div>
  {% endblock content %}
</div>
